# Docker Compose for local e2e testing of MCP server
# Usage: docker compose -f docker-compose.test.yml up --build

services:
  mcp-server:
    build:
      context: ../..
      dockerfile: applications/mcp-server/Dockerfile
    ports:
      - "8080:8080"
    environment:
      # Server configuration
      MCP_SERVER_PORT: "8080"
      MCP_SERVER_HOST: "0.0.0.0"
      # OAuth configuration (test mode - uses mock validation)
      OAUTH_GATEWAY_URL: "https://ag.etus.io"
      MCP_RESOURCE_URI: "http://localhost:8080/mcp"
      # Cache configuration
      CACHE_TTL: "60"
      # Logging
      PYTHONUNBUFFERED: "1"
      LOG_LEVEL: "INFO"
    volumes:
      # Mount googleads.yaml for real API testing (optional)
      # Comment out for mock mode testing
      - ../../googleads.yaml:/home/nonroot/.googleads.yaml:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 10s
    restart: "no"
